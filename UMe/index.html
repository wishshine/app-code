<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="libs/mui/js/mui.min.js"></script>
		<link href="libs/mui/css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="css/app.css" />
	</head>

	<body>
		<header class="mui-bar mui-bar-nav theme-bac">
			<h1 class="mui-title theme-color ">标题</h1>
		</header>
		<nav class="mui-bar mui-bar-tab" id="navBar">
			<div class="mui-tab-item mui-active" page-id="message">
				<span class="mui-icon mui-icon-email"></span>
				<span class="mui-tab-label">消息</span>
			</div>
			<div class="mui-tab-item" page-id="linkList">
				<span class="mui-icon mui-icon-contact"></span>
				<span class="mui-tab-label">通讯录</span>
			</div>
			<div class="mui-tab-item" page-id="message">
				<span class="mui-icon mui-icon-contact"></span>
				<span class="mui-tab-label">发现</span>
			</div>
			<div class="mui-tab-item" page-id="message">
				<span class="mui-icon mui-icon-gear"></span>
				<span class="mui-tab-label">我的</span>
			</div>
		</nav>
	</body>
	<script type="text/javascript" src="js/config.js"></script>
	<script type="text/javascript" src="js/app.js"></script>
	<script type="text/javascript" charset="utf-8">
		var indexData = {
			subpages: [], //子页面
			activePageId: '', //激活页id
		};

		function isNeedLogin() {
			var userInfo = AppUtils.store.getUserInfo();
			if(userInfo == undefined || AppUtils.common.isStrBlank(userInfo.token)) {
				return true;
			}
			return false;
		}

		function init() {
			mui.toast('调用初始化');
			if(isNeedLogin()) {
				AppUtils.ui.goLoginView(); //跳转到登录页面
				return;
			}
			initSubpages();
			bindEvent();
		}

		function initSubpages() {
			indexData.subpages = AppConfig.subpages;
			indexData.activePageId = AppConfig.activePageId;
			var self = plus.webview.currentWebview();
			for(var key in indexData.subpages) {
				var subpage = indexData.subpages[key];
				var sub = plus.webview.create(subpage.url, subpage.id, subpage.styles);
				if(key != indexData.activePageId) {
					sub.hide();
				}
				self.append(sub);
			}
		}

		function bindEvent() {
			mui("#navBar").on('tap', '.mui-tab-item', function() {
				//获取id
				var pageId = this.getAttribute("page-id");
				console.log(pageId);
				if(pageId == indexData.activePageId) {
					retrun;
				}
				plus.webview.getWebviewById(pageId).show('fade-in');
				indexData.activePageId = pageId;
			});
		}

		mui.plusReady(function() {
			init(); //初始化

		});
	</script>

</html>